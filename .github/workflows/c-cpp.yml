name: C/C++ CI

on:
  workflow_dispatch:

jobs:
  build:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4
   
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1.1

    # - name: Restore NuGet packages
    #   run: nuget restore VmLoader.sln

    - name: Build Solution
      # run: msbuild VmLoader.sln /p:Configuration=Release
      run: msbuild VmLoader.sln /p:Configuration=Release /p:WindowsTargetPlatformVersion=10.0.19041.0 /p:AdditionalIncludeDirectories="C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\km"
      
    # - name: Find WDK Path
    #   id: find-wdk
    #   run: |
    #     $wdk_path = (Get-ChildItem -Path "C:\Program Files (x86)\Windows Kits\10\Include" -Filter "km" -Recurse | Select-Object -First 1).DirectoryName
    #     echo "WDK_INCLUDE_PATH=$wdk_path" >> $env:GITHUB_OUTPUT

    # - name: Build Solution
    #   run: msbuild VmLoader.sln /p:Configuration=Release /p:WindowsTargetPlatformVersion=10.0.19041.0 /p:Platform=x64 /p:AdditionalIncludeDirectories="${{ steps.find-wdk.outputs.WDK_INCLUDE_PATH }}"
